<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giviso Neural Brain - Evolution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --cyan: #06b6d4; --bg: #050508; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        .font-futuristic { font-family: 'Orbitron', sans-serif; }
        .glass-panel { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        #network-container { width: 100vw; height: 100vh; background: radial-gradient(circle at center, #0d0d1f 0%, #050508 100%); }
        
        /* Vis.js Tool Manipulation Style */
        .vis-network { outline: none; }
        .vis-edit-mode { background: rgba(6, 182, 212, 0.1) !important; border-bottom: 1px solid var(--cyan) !important; }
        .vis-button { background-color: transparent !important; color: #fff !important; border: 1px solid rgba(255,255,255,0.2) !important; border-radius: 4px !important; margin: 5px !important; }
        .vis-button:hover { background-color: var(--cyan) !important; }
    </style>
</head>
<body>

    <div class="fixed top-6 left-8 z-50 pointer-events-none">
        <h1 class="font-futuristic text-2xl text-cyan-400 tracking-tighter glow-text uppercase">Giviso_Brain_Evolution</h1>
        <p class="text-[9px] text-gray-500 uppercase tracking-[0.4em]">Hệ thống phân nhánh tri thức chủ động</p>
    </div>

    <div class="fixed top-24 left-8 z-50 w-56 glass-panel rounded-2xl p-5 border-l-2 border-cyan-500">
        <h3 class="font-futuristic text-[10px] text-cyan-400 mb-4 tracking-widest uppercase">Radar Định Vị</h3>
        <div id="node-list" class="max-h-[40vh] overflow-y-auto space-y-1 pr-2 text-[11px]"></div>
    </div>

    <div id="data-panel" class="fixed top-0 right-0 h-full w-96 glass-panel z-[100] transform translate-x-full transition-transform duration-500 p-8 border-l border-cyan-500/20">
        <button onclick="closePanel()" class="absolute top-6 right-8 text-gray-500 hover:text-white font-futuristic text-xs">[ ĐÓNG ]</button>
        <div id="panel-body" class="mt-8">
            </div>
    </div>

    <div id="network-container"></div>

    <script>
        let nodes = new vis.DataSet(JSON.parse(localStorage.getItem('brain_ev_nodes')) || [{ id: 1, label: 'GIVISO', color: '#06b6d4', level: 3 }]);
        let edges = new vis.DataSet(JSON.parse(localStorage.getItem('brain_ev_edges')) || []);

        function saveData() {
            localStorage.setItem('brain_ev_nodes', JSON.stringify(nodes.get()));
            localStorage.setItem('brain_ev_edges', JSON.stringify(edges.get()));
        }

        const container = document.getElementById('network-container');
        const options = {
            nodes: { shape: 'dot', font: { color: '#ffffff', size: 14, face: 'Inter' }, borderWidth: 2 },
            edges: { color: { color: 'rgba(255,255,255,0.2)', highlight: '#06b6d4' }, arrows: { to: { enabled: true, scaleFactor: 0.5 } } },
            manipulation: {
                enabled: true, // CÁCH 1: KÉO THẢ TẠO LIÊN KẾT QUA THANH CÔNG CỤ
                addEdge: function (data, callback) {
                    if (data.from == data.to) return;
                    callback(data);
                    saveData();
                }
            },
            physics: { enabled: true, barnesHut: { gravitationalConstant: -2000 } }
        };

        const network = new vis.Network(container, { nodes, edges }, options);

        // CÁCH 2: PHÂN NHÁNH TỪ NÚT ĐƯỢC CHỌN (DẤU +)
        function spawnBranch(parentId) {
            const label = prompt("Nhập ý tưởng nhánh mới:");
            if (label) {
                const newId = Date.now();
                nodes.add({ id: newId, label, color: '#94a3b8', level: 1 });
                edges.add({ from: parentId, to: newId });
                saveData();
                teleport(newId);
            }
        }

        function openPanelById(id) {
            const node = nodes.get(id);
            const panel = document.getElementById('data-panel');
            panel.classList.remove('translate-x-full');
            document.getElementById('panel-body').innerHTML = `
                <h2 class="text-2xl font-bold text-white font-futuristic mb-6 uppercase">${node.label}</h2>
                
                <button onclick="spawnBranch(${id})" class="w-full py-4 mb-6 bg-cyan-500/10 border border-dashed border-cyan-500/50 rounded-xl flex items-center justify-center gap-3 hover:bg-cyan-500/20 transition-all group">
                    <span class="text-2xl font-bold text-cyan-400 group-hover:scale-125 transition-transform">+</span>
                    <span class="text-[10px] text-cyan-400 font-futuristic">SINH NHÁNH MỚI</span>
                </button>

                <div class="mb-6">
                    <label class="text-[10px] text-gray-500 uppercase">Ghi chú não bộ</label>
                    <textarea id="node-note" class="w-full h-48 bg-black/40 border border-white/10 rounded-xl mt-2 p-4 text-xs text-gray-300 focus:outline-none focus:border-cyan-500">${node.note || ''}</textarea>
                </div>
                <button onclick="updateNote(${id})" class="w-full py-2 bg-cyan-600 text-white text-[10px] font-bold rounded-lg uppercase">Cập nhật ghi chú</button>
            `;
        }

        // ĐIỀU HƯỚNG & CẬP NHẬT RADAR
        function updateRadar() {
            const list = document.getElementById('node-list');
            list.innerHTML = nodes.get().map(node => `
                <div onclick="teleport(${node.id})" class="p-2 cursor-pointer hover:bg-white/5 rounded flex items-center">
                    <span class="w-2 h-2 rounded-full mr-2" style="background:${node.color}"></span> ${node.label}
                </div>`).join('');
        }

        function teleport(id) {
            network.focus(id, { scale: 1.2, animation: { duration: 800 } });
            network.selectNodes([id]);
            openPanelById(id);
        }

        function updateNote(id) {
            nodes.update({ id, note: document.getElementById('node-note').value });
            saveData();
            alert("Đã ghi nhớ!");
        }

        network.on("click", (p) => p.nodes.length > 0 ? openPanelById(p.nodes[0]) : closePanel());
        function closePanel() { document.getElementById('data-panel').classList.add('translate-x-full'); }
        nodes.on('*', updateRadar);
        updateRadar();
    </script>
</body>
</html>
