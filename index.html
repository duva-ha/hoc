<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giviso Neural Brain - Second Brain System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body { background: #050508; color: #e2e8f0; font-family: 'Inter', sans-serif; overflow: hidden; }
        .font-futuristic { font-family: 'Orbitron', sans-serif; }
        #network-container { width: 100vw; height: 100vh; background: radial-gradient(circle at center, #0a0a1a 0%, #050508 100%); }
        .control-panel { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>

    <div class="fixed top-6 left-6 z-50 pointer-events-none">
        <h1 class="font-futuristic text-2xl text-cyan-400 tracking-tighter">NEURAL_BRAIN_V1</h1>
        <p class="text-[10px] text-gray-500 uppercase tracking-[0.3em]">Hệ thống lưu trữ & Truy xuất tư duy</p>
    </div>

    <div class="fixed bottom-6 left-6 z-50 control-panel p-4 rounded-xl text-[11px] text-gray-400 space-y-1">
        <p><b class="text-cyan-400">[A]</b>: Thêm ý tưởng mới</p>
        <p><b class="text-cyan-400">[L]</b>: Kết nối 2 nút (Link)</p>
        <p><b class="text-cyan-400">[Double Click]</b>: Đánh giá mức độ hiểu</p>
        <p><b class="text-red-500">[Del]</b>: Xóa dữ liệu</p>
    </div>

    <div id="data-panel" class="fixed top-0 right-0 h-full w-80 control-panel z-50 transform translate-x-full transition-transform duration-500 p-6">
        <div id="panel-body">
            <h2 class="font-futuristic text-cyan-400 mb-4 uppercase">Thông tin truy xuất</h2>
            <hr class="border-white/10 mb-6">
            <div id="info-content" class="space-y-4">
                </div>
        </div>
    </div>

    <div id="network-container"></div>

    <script>
        // 1. DỮ LIỆU GỐC & LƯU TRỮ
        let nodes = new vis.DataSet(JSON.parse(localStorage.getItem('brain_nodes')) || [
            { id: 1, label: 'GIVISO', color: '#06b6d4', size: 30, level: 3 }
        ]);
        let edges = new vis.DataSet(JSON.parse(localStorage.getItem('brain_edges')) || []);

        const container = document.getElementById('network-container');
        const data = { nodes, edges };

        // 2. CẤU HÌNH HỆ THỐNG
        const options = {
            nodes: {
                shape: 'dot',
                font: { color: '#ffffff', size: 14, face: 'Inter' },
                borderWidth: 2,
                shadow: { enabled: true, color: 'rgba(0,255,255,0.2)', size: 10 }
            },
            edges: {
                color: { color: 'rgba(255,255,255,0.2)', highlight: '#06b6d4' },
                arrows: { to: { enabled: true, scaleFactor: 0.5 } },
                smooth: { type: 'continuous' }
            },
            physics: {
                enabled: true,
                barnesHut: { gravitationalConstant: -3000, springLength: 150 },
                stabilization: { iterations: 100 }
            }
        };

        const network = new vis.Network(container, data, options);

        // 3. LOGIC XỬ LÝ "NÃO BỘ"
        function save() {
            localStorage.setItem('brain_nodes', JSON.stringify(nodes.get()));
            localStorage.setItem('brain_edges', JSON.stringify(edges.get()));
        }

        window.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            
            // THÊM NÚT (A)
            if (key === 'a') {
                const label = prompt("Nhập ý tưởng/Kiến thức mới:");
                if (label) {
                    const id = Date.now();
                    nodes.add({ id, label, color: '#94a3b8', level: 1 }); // Mặc định màu xám (chưa hiểu)
                    save();
                }
            }

            // KẾT NỐI (L) - Chọn 2 nút rồi nhấn L
            if (key === 'l') {
                const selected = network.getSelectedNodes();
                if (selected.length === 2) {
                    edges.add({ from: selected[0], to: selected[1] });
                    save();
                } else {
                    alert("Hãy chọn đúng 2 nút để kết nối!");
                }
            }

            // XÓA (Delete)
            if (e.key === 'Delete') {
                const selected = network.getSelectedNodes();
                nodes.remove(selected);
                save();
            }
        });

        // CẬP NHẬT MỨC ĐỘ HIỂU (Double Click)
        network.on("doubleClick", function (params) {
            if (params.nodes.length > 0) {
                const id = params.nodes[0];
                const current = nodes.get(id);
                
                // Chu trình: 1 (Xám - Mới) -> 2 (Vàng - Đang học) -> 3 (Xanh - Đã hiểu)
                let nextLevel = (current.level || 1) + 1;
                if (nextLevel > 3) nextLevel = 1;

                const colors = { 1: '#94a3b8', 2: '#eab308', 3: '#22c55e' };
                nodes.update({ id, level: nextLevel, color: colors[nextLevel] });
                save();
            }
        });

        // TRUY XUẤT THÔNG TIN (Click)
        network.on("click", function (params) {
            const panel = document.getElementById('data-panel');
            if (params.nodes.length > 0) {
                const id = params.nodes[0];
                const node = nodes.get(id);
                const connectedEdges = edges.get({ filter: e => e.from === id || e.to === id });
                
                panel.classList.remove('translate-x-full');
                document.getElementById('info-content').innerHTML = `
                    <div class="text-xs text-gray-500 uppercase">Đối tượng</div>
                    <div class="text-xl font-bold text-white mb-4">${node.label}</div>
                    
                    <div class="text-[10px] text-gray-500 uppercase">Mức độ hiểu</div>
                    <div class="flex items-center mt-1">
                        <span class="status-dot" style="background:${node.color}"></span>
                        <span class="text-sm">${node.level === 3 ? 'Đã nắm vững' : node.level === 2 ? 'Đang nghiên cứu' : 'Dữ liệu thô'}</span>
                    </div>

                    <div class="mt-6 text-[10px] text-gray-500 uppercase">Liên kết liên quan</div>
                    <div class="text-xs mt-2 text-cyan-400 italic">
                        Có ${connectedEdges.length} kết nối trong mạng lưới thần kinh.
                    </div>
                `;
            } else {
                panel.classList.add('translate-x-full');
            }
        });
    </script>
</body>
</html>
