<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giviso AI Brain - Autonomous V8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --cyan: #06b6d4; --bg: #050508; --ai-glow: #8b5cf6; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        .font-futuristic { font-family: 'Orbitron', sans-serif; }
        .glass-panel { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.1); }
        #network-container { width: 100vw; height: 100vh; background: radial-gradient(circle at center, #110c1d 0%, #050508 100%); }
        
        /* Hiệu ứng AI đang "tư duy" */
        @keyframes ai-thinking {
            0% { box-shadow: 0 0 5px var(--ai-glow); }
            50% { box-shadow: 0 0 30px var(--ai-glow); border-color: var(--ai-glow); }
            100% { box-shadow: 0 0 5px var(--ai-glow); }
        }
        .ai-active { animation: ai-thinking 2s infinite ease-in-out; }
    </style>
</head>
<body>

    <div class="fixed top-6 left-8 z-50 pointer-events-none">
        <h1 class="font-futuristic text-2xl text-cyan-400 tracking-tighter uppercase">AI_Neural_Autonomous</h1>
        <div class="flex items-center gap-3 mt-1">
            <span id="ai-status-dot" class="w-2 h-2 rounded-full bg-purple-500 animate-ping"></span>
            <p id="ai-status-text" class="text-[8px] text-purple-400 uppercase tracking-[0.3em]">AI Engine: Đang quan sát nội dung...</p>
        </div>
    </div>

    <div class="fixed top-24 left-8 z-50 w-64 glass-panel rounded-2xl p-6 border-l-2 border-purple-600 shadow-2xl">
        <h3 class="font-futuristic text-[10px] text-purple-400 mb-4 tracking-widest uppercase italic">Phân tích tư duy</h3>
        <div id="node-list" class="max-h-[30vh] overflow-y-auto space-y-1 text-[11px] mb-4 pr-2 border-b border-white/5 pb-4"></div>
        <div class="space-y-2">
            <button onclick="aiSuggestNode()" class="w-full py-3 bg-purple-600/20 border border-purple-500/30 rounded-xl text-[9px] text-purple-300 hover:bg-purple-600 hover:text-white transition-all uppercase font-bold tracking-widest">
                ✧ AI Tự sinh nút mới
            </button>
            <button onclick="activateAddNodeMode()" class="w-full py-2 text-[8px] text-gray-500 hover:text-white transition uppercase">Thêm thủ công [N]</button>
        </div>
    </div>

    <div id="data-panel" class="fixed top-0 right-0 h-full w-[450px] glass-panel z-[100] transform translate-x-full transition-transform duration-500 p-10 border-l border-purple-500/20 shadow-[-20px_0_50px_rgba(139,92,246,0.1)]">
        <button onclick="closePanel()" class="text-gray-500 hover:text-white text-[10px] mb-10 uppercase font-futuristic">✕ Đóng bộ nhớ</button>
        <div id="panel-body" class="space-y-6"></div>
    </div>

    <div id="network-container"></div>

    <script>
        let nodes = new vis.DataSet(JSON.parse(localStorage.getItem('brain_ai_nodes')) || [{ id: 1, label: 'GIVISO_AI', color: '#8b5cf6', level: 3 }]);
        let edges = new vis.DataSet(JSON.parse(localStorage.getItem('brain_ai_edges')) || []);
        let selectedNodeId = null;

        const options = {
            nodes: { shape: 'dot', font: { color: '#ffffff', face: 'Inter' }, borderWidth: 2, shadow: true },
            edges: { color: { color: 'rgba(139,92,246,0.2)' }, arrows: 'to', smooth: true, dashes: true },
            physics: { enabled: true, barnesHut: { gravitationalConstant: -4000, springConstant: 0.04 } }
        };

        const network = new vis.Network(document.getElementById('network-container'), { nodes, edges }, options);

        // --- 1. TÍNH NĂNG "AI TỰ HỌC & ĐỀ XUẤT" ---
        function aiSuggestNode() {
            if (!selectedNodeId) {
                showToast("Vui lòng chọn một nút mẹ để AI phân tích!");
                return;
            }
            const parentLabel = nodes.get(selectedNodeId).label;
            document.getElementById('ai-status-text').innerText = "AI: Đang phân tích mối liên hệ...";
            
            // Giả lập AI tự sinh nút dựa trên ngữ cảnh bài giảng của thầy
            const database = {
                "Công nghệ": ["Vật liệu", "Cơ khí", "Điện tử", "Tự động hóa"],
                "Lớp 10A7": ["Tổ 1", "Tổ 2", "Học tập", "Nề nếp"],
                "Tiếng Trung": ["Từ vựng", "Ngữ pháp", "Hán tự", "HSK"],
                "Động cơ": ["Piston", "Xi lanh", "Trục khuỷu", "Hệ thống bôi trơn"]
            };

            let suggestions = database[parentLabel] || ["Ý tưởng 1", "Ý tưởng 2"];
            
            // Tự động sinh ra 1 nút mới ngẫu nhiên từ gợi ý
            const newLabel = suggestions[Math.floor(Math.random() * suggestions.length)];
            const newId = Date.now();
            
            nodes.add({ id: newId, label: `AI: ${newLabel}`, color: '#a78bfa', level: 1, note: 'Nút này được sinh ra tự động từ trí tuệ của hệ thống.' });
            edges.add({ from: selectedNodeId, to: newId });
            
            document.getElementById('ai-status-text').innerText = "AI: Đã sinh ra nút mới!";
            saveData();
        }

        // --- 2. TÍNH NĂNG "TƯƠNG TÁC SÂU" ---
        function openPanelById(id) {
            const node = nodes.get(id);
            document.getElementById('data-panel').classList.remove('translate-x-full');
            document.getElementById('panel-body').innerHTML = `
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center animate-pulse shadow-[0_0_15px_#8b5cf6]">
                        <span class="text-xs">AI</span>
                    </div>
                    <h2 class="text-xl font-bold text-white font-futuristic uppercase">${node.label}</h2>
                </div>
                
                <div class="space-y-4">
                    <div class="glass-panel p-6 rounded-2xl border-purple-500/20">
                        <p class="text-[9px] text-purple-400 uppercase tracking-widest mb-4">Ghi chú & Tương tác</p>
                        <textarea id="node-note" class="w-full h-64 bg-transparent text-xs text-gray-300 focus:outline-none leading-relaxed resize-none" placeholder="Viết gì đó để AI học tập...">${node.note || ''}</textarea>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="aiSummarize(${id})" class="flex-1 py-3 bg-white/5 border border-white/10 rounded-xl text-[8px] text-gray-400 hover:border-purple-500 transition uppercase">AI Tóm tắt</button>
                        <button onclick="updateNote(${id})" class="flex-1 py-3 bg-purple-600 text-white text-[8px] font-bold rounded-xl uppercase shadow-lg">Lưu & Học tập</button>
                    </div>
                </div>
            `;
        }

        function aiSummarize(id) {
            const node = nodes.get(id);
            if(!node.note) return;
            document.getElementById('node-note').value = "AI ĐANG TÓM TẮT...\n---\n" + node.note.substring(0, 50) + "... [Đây là bản tóm tắt thông minh từ bộ não Giviso]";
        }

        // --- CƠ CHẾ VẬT LÝ NHÚC NHÍCH TỰ NHIÊN ---
        network.on("click", (p) => {
            if (p.nodes.length > 0) {
                selectedNodeId = p.nodes[0];
                openPanelById(selectedNodeId);
                network.startSimulation();
            } else {
                document.getElementById('data-panel').classList.add('translate-x-full');
            }
        });

        function saveData() { localStorage.setItem('brain_ai_nodes', JSON.stringify(nodes.get())); localStorage.setItem('brain_ai_edges', JSON.stringify(edges.get())); }
        function teleport(id) { network.focus(id, { scale: 1.2, animation: true }); network.selectNodes([id]); openPanelById(id); }
        
        nodes.on('*', () => {
            document.getElementById('node-list').innerHTML = nodes.get().map(n => `<div onclick="teleport(${n.id})" class="p-2 cursor-pointer hover:bg-purple-500/10 rounded-lg flex items-center group"><span class="w-1.5 h-1.5 rounded-full mr-3" style="background:${n.color}"></span>${n.label}</div>`).join('');
        });

        window.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && document.activeElement.tagName !== 'TEXTAREA') { e.preventDefault(); network.fit({animation:true}); }
        });
    </script>
</body>
</html>
